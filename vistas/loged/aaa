<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Usuarios</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- EasyUI CSS -->
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/icon.css">
    
    <script src="https://www.jeasyui.com/easyui/jquery.min.js"></script>
    <script src="https://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        .container { max-width: 70%; margin-top: 20px; }
        .btn-custom { background-color: #f8f9fa; border: none; }
        .btn-custom:hover { background-color: #e9ecef; }
        .modal-content { border-radius: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center">Gestión de Usuarios</h2>
        
        <!-- Tabla de usuarios -->
        <table id="tablaUsuarios" class="easyui-datagrid table"
                style="width:100%; height:300px"
                url="index.php?c=usuarios&m=consultarUsuarios"
                toolbar="#toolbar" pagination="true"
                rownumbers="true" fitColumns="true" singleSelect="true">
            <thead class="table-light">
                <tr>
                    <th field="id" width="10">ID</th>
                    <th field="name" width="50">Nombre</th>
                    <th field="user_type_id" width="15">Tipo</th>
                    <th field="active" width="15">Activo</th>
                </tr>
            </thead>
        </table>

        <!-- Botones -->
        <div id="toolbar" class="d-flex justify-content-between align-items-center">
            <div>
                <input id="searchbox" class="form-control d-inline-block" style="width:200px" placeholder="Buscar usuario">
                <button class="btn btn-custom btn-sm" onclick="doSearch()">
                    <i class="fa fa-search"></i>
                </button>
            </div>
            <div class="ms-auto">
                <button class="btn btn-custom btn-sm" onclick="newUser()">
                    <i class="fa fa-user-plus"></i>
                </button>
                <button class="btn btn-custom btn-sm" onclick="editUser()">
                    <i class="fa fa-edit"></i>
                </button>
                <button class="btn btn-custom btn-sm" onclick="destroyUser()">
                    <i class="fa fa-trash"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        function newUser(){
            $('#dlg').modal('show');
            $('#fm')[0].reset();
            url = 'usuarios_controller.php?action=crear';
        }

        function editUser(){
            var row = $('#dg').datagrid('getSelected');
            if (row){
                $('#dlg').modal('show');
                $('#fm')[0].reset();
                $('input[name="firstname"]').val(row.name);
                $('input[name="lastname"]').val(row.lastname);
                $('input[name="phone"]').val(row.phone);
                $('input[name="email"]').val(row.email);
                url = 'usuarios_controller.php?action=actualizar&id='+row.id;
            }
        }

        function saveUser(){
            $.post(url, $('#fm').serialize(), function(result){
                if (result.error) {
                    alert('Error: ' + result.msg);
                } else {
                    $('#dlg').modal('hide');
                    $('#dg').datagrid('reload');
                }
            }, 'json');
        }

        function destroyUser(){
            var row = $('#dg').datagrid('getSelected');
            if (row){
                if (confirm('¿Estás seguro de eliminar este usuario?')) {
                    $.post('usuarios_controller.php?action=eliminar', {id: row.id}, function(result){
                        if (result.error) {
                            alert('Error: ' + result.msg);
                        } else {
                            $('#dg').datagrid('reload');
                        }
                    }, 'json');
                }
            }
        }

        function doSearch() {
            var value = $('#searchbox').val();
            $('#dg').datagrid('load', { name: value });
        }
    </script>
    <script type="text/javascript" src="js/script_trans.js"></script>
</body>
</html>